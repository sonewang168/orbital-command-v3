<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ∞Ô∏è ORBITAL COMMAND - Â§™Á©∫Ê∞£Ë±°ÊåáÊèÆ‰∏≠ÂøÉ v2.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-cyan: #00f5ff;
            --primary-blue: #0080ff;
            --primary-purple: #a855f7;
            --primary-pink: #ff00ff;
            --warning-orange: #ff9500;
            --danger-red: #ff3b3b;
            --success-green: #00ff88;
            --bg-dark: #030810;
            --bg-panel: rgba(5, 15, 35, 0.92);
            --border-glow: rgba(0, 245, 255, 0.3);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scanline */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 245, 255, 0.015) 2px, rgba(0, 245, 255, 0.015) 4px);
            pointer-events: none;
            z-index: 9999;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, rgba(0, 245, 255, 0.1) 0%, transparent 100%);
            border-bottom: 1px solid var(--border-glow);
            padding: 12px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary-cyan), var(--primary-purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            box-shadow: 0 0 25px rgba(0, 245, 255, 0.4);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 25px rgba(0, 245, 255, 0.4); }
            50% { box-shadow: 0 0 35px rgba(0, 245, 255, 0.6); }
        }

        .logo-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-cyan), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-subtitle {
            font-size: 10px;
            color: var(--text-secondary);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .header-center {
            display: flex;
            gap: 25px;
        }

        .header-stat {
            text-align: center;
            padding: 5px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .header-stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            color: var(--primary-cyan);
        }

        .header-stat-label {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .time-display {
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            color: var(--primary-cyan);
            text-align: right;
        }

        /* Alert Bar */
        .alert-bar {
            background: linear-gradient(90deg, rgba(255, 149, 0, 0.1), rgba(255, 59, 59, 0.1));
            border-bottom: 1px solid rgba(255, 149, 0, 0.3);
            padding: 8px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            overflow: hidden;
        }

        .alert-icon {
            font-size: 18px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .alert-text {
            font-size: 13px;
            color: var(--warning-orange);
            white-space: nowrap;
            animation: scroll-left 20s linear infinite;
        }

        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* Main Layout */
        .main-container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 15px;
            padding: 15px;
            min-height: calc(100vh - 120px);
        }

        /* Panels */
        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-glow);
            border-radius: 10px;
            backdrop-filter: blur(15px);
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(90deg, rgba(0, 245, 255, 0.1), transparent);
            border-bottom: 1px solid var(--border-glow);
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--primary-cyan), var(--primary-blue));
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .panel-status {
            margin-left: auto;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(0, 255, 136, 0.2);
            color: var(--success-green);
        }

        .panel-content {
            padding: 12px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 12px;
        }

        .tab {
            flex: 1;
            padding: 8px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .tab:hover { background: rgba(255,255,255,0.08); }
        .tab.active {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.2), rgba(168, 85, 247, 0.2));
            border-color: var(--primary-cyan);
            color: var(--primary-cyan);
        }

        /* Aurora */
        .aurora-display {
            position: relative;
            height: 100px;
            background: linear-gradient(180deg, #0a0a1a 0%, #1a0a2e 100%);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .aurora-effect {
            position: absolute;
            top: 10%; left: 0; right: 0; height: 60%;
            background: linear-gradient(90deg, transparent 0%, rgba(0, 255, 136, 0.3) 20%, rgba(0, 245, 255, 0.4) 40%, rgba(168, 85, 247, 0.4) 60%, rgba(255, 0, 255, 0.3) 80%, transparent 100%);
            filter: blur(12px);
            animation: aurora-move 4s ease-in-out infinite;
        }

        .aurora-effect-2 {
            position: absolute;
            top: 20%; left: 0; right: 0; height: 40%;
            background: linear-gradient(90deg, transparent 0%, rgba(0, 255, 136, 0.2) 30%, rgba(0, 245, 255, 0.3) 50%, rgba(168, 85, 247, 0.2) 70%, transparent 100%);
            filter: blur(18px);
            animation: aurora-move 6s ease-in-out infinite reverse;
        }

        @keyframes aurora-move {
            0%, 100% { transform: translateX(-15%) skewX(-5deg); opacity: 0.8; }
            50% { transform: translateX(15%) skewX(5deg); opacity: 1; }
        }

        .aurora-stars {
            position: absolute;
            width: 100%; height: 100%;
            background-image: radial-gradient(1px 1px at 20px 30px, white, transparent), radial-gradient(1px 1px at 50px 20px, white, transparent), radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.6), transparent), radial-gradient(1px 1px at 130px 60px, white, transparent);
        }

        .kp-meter {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: rgba(0, 255, 136, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .kp-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 36px;
            font-weight: 900;
            color: var(--success-green);
            text-shadow: 0 0 25px rgba(0, 255, 136, 0.5);
            min-width: 50px;
        }

        .kp-details { flex: 1; }

        .kp-label {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .kp-status { font-size: 13px; font-weight: 600; }
        .kp-status.quiet { color: var(--success-green); }
        .kp-status.active { color: #ffcc00; }
        .kp-status.storm { color: var(--warning-orange); }
        .kp-status.severe { color: var(--danger-red); }

        .kp-bar {
            display: flex;
            gap: 2px;
            margin-top: 8px;
        }

        .kp-bar-segment {
            flex: 1;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .kp-bar-segment.active-green { background: var(--success-green); box-shadow: 0 0 8px var(--success-green); }
        .kp-bar-segment.active-yellow { background: #ffcc00; box-shadow: 0 0 8px #ffcc00; }
        .kp-bar-segment.active-orange { background: var(--warning-orange); box-shadow: 0 0 8px var(--warning-orange); }
        .kp-bar-segment.active-red { background: var(--danger-red); box-shadow: 0 0 8px var(--danger-red); }

        .aurora-locations {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 10px;
        }

        .aurora-location {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 5px;
            font-size: 12px;
        }

        .aurora-location-chance {
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .chance-high { background: rgba(0, 255, 136, 0.2); color: var(--success-green); }
        .chance-medium { background: rgba(255, 204, 0, 0.2); color: #ffcc00; }
        .chance-low { background: rgba(255, 255, 255, 0.1); color: var(--text-secondary); }

        /* Solar Flare */
        .flare-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .flare-card {
            text-align: center;
            padding: 10px 5px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .flare-class {
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            font-weight: 700;
        }

        .flare-class.x { color: var(--danger-red); text-shadow: 0 0 15px rgba(255, 59, 59, 0.5); }
        .flare-class.m { color: var(--warning-orange); text-shadow: 0 0 15px rgba(255, 149, 0, 0.5); }
        .flare-class.c { color: #ffcc00; text-shadow: 0 0 15px rgba(255, 204, 0, 0.5); }

        .flare-label {
            font-size: 9px;
            color: var(--text-secondary);
            margin-top: 3px;
        }

        .flare-count {
            font-size: 11px;
            margin-top: 5px;
        }

        /* CME */
        .cme-event {
            padding: 10px;
            background: linear-gradient(135deg, rgba(255, 59, 59, 0.1), rgba(255, 149, 0, 0.1));
            border: 1px solid rgba(255, 149, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .cme-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .cme-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            color: var(--warning-orange);
        }

        .cme-time {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .cme-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .cme-stat {
            text-align: center;
            padding: 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
        }

        .cme-stat-value {
            font-family: 'Share Tech Mono', monospace;
            font-size: 14px;
            color: var(--warning-orange);
        }

        .cme-stat-label {
            font-size: 9px;
            color: var(--text-secondary);
        }

        /* Solar Wind */
        .solar-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary-cyan);
        }

        .solar-stat-info { display: flex; flex-direction: column; }

        .solar-stat-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .solar-stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            color: var(--primary-cyan);
        }

        .solar-stat-unit {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .solar-stat-trend { font-size: 18px; }
        .trend-up { color: var(--danger-red); }
        .trend-down { color: var(--success-green); }
        .trend-stable { color: var(--text-secondary); }

        /* Radiation */
        .radiation-meter {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .radiation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .radiation-level {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
        }

        .radiation-level.safe { color: var(--success-green); }
        .radiation-level.elevated { color: #ffcc00; }
        .radiation-level.high { color: var(--warning-orange); }
        .radiation-level.severe { color: var(--danger-red); }

        .radiation-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .radiation-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-green), #ffcc00, var(--warning-orange), var(--danger-red));
            border-radius: 4px;
            transition: width 0.5s;
        }

        /* Globe */
        .globe-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .globe-container {
            flex: 1;
            min-height: 400px;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: radial-gradient(ellipse at center, rgba(0, 80, 150, 0.1) 0%, transparent 70%);
            border: 1px solid var(--border-glow);
            touch-action: none; /* Èò≤Ê≠¢Ëß∏ÊéßÊôÇÈ†ÅÈù¢ÊªæÂãï */
        }

        #globe-canvas { 
            width: 100%; 
            height: 100%; 
            touch-action: none;
        }

        .globe-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            background: radial-gradient(ellipse at center, transparent 40%, rgba(0, 0, 0, 0.4) 100%);
        }

        .globe-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .globe-btn {
            width: 32px;
            height: 32px;
            background: var(--bg-panel);
            border: 1px solid var(--border-glow);
            border-radius: 6px;
            color: var(--primary-cyan);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .globe-btn:hover {
            background: rgba(0, 245, 255, 0.2);
        }

        .globe-btn.active {
            background: rgba(0, 245, 255, 0.3);
            border-color: var(--primary-cyan);
        }

        .globe-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: var(--bg-panel);
            border: 1px solid var(--border-glow);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 11px;
        }

        .globe-info-row {
            display: flex;
            gap: 15px;
        }

        .globe-info-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .globe-info-label { color: var(--text-secondary); }
        .globe-info-value { color: var(--primary-cyan); font-family: 'Share Tech Mono', monospace; }

        /* Bottom Stats */
        .bottom-stats {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .bottom-stat {
            background: var(--bg-panel);
            border: 1px solid var(--border-glow);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .bottom-stat-icon { font-size: 20px; margin-bottom: 5px; }
        .bottom-stat-value { font-family: 'Orbitron', sans-serif; font-size: 18px; color: var(--primary-cyan); }
        .bottom-stat-label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }

        /* ISS */
        .iss-card {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(0, 245, 255, 0.1));
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .iss-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .iss-icon {
            font-size: 22px;
            animation: iss-float 3s ease-in-out infinite;
        }

        @keyframes iss-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        .iss-title { font-family: 'Orbitron', sans-serif; font-size: 12px; color: var(--primary-purple); }

        .iss-status {
            font-size: 10px;
            color: var(--success-green);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .iss-status::before {
            content: '';
            width: 5px; height: 5px;
            background: var(--success-green);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .iss-coords {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .iss-coord {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 6px;
            text-align: center;
        }

        .iss-coord-label { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; }
        .iss-coord-value { font-family: 'Share Tech Mono', monospace; font-size: 12px; color: var(--primary-cyan); }

        .iss-orbit-info {
            margin-top: 10px;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Ocean */
        .ocean-viz {
            height: 70px;
            background: linear-gradient(180deg, rgba(0, 128, 255, 0.1) 0%, rgba(0, 80, 160, 0.2) 50%, rgba(0, 40, 80, 0.3) 100%);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .wave {
            position: absolute;
            bottom: 0; left: 0;
            width: 200%; height: 25px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath fill='rgba(0,128,255,0.3)' d='M0,60 C300,120 600,0 900,60 C1200,120 1500,0 1800,60 V120 H0 Z'/%3E%3C/svg%3E") repeat-x;
            animation: wave 3s linear infinite;
        }

        .wave:nth-child(2) {
            bottom: 5px;
            opacity: 0.5;
            animation-duration: 4s;
            animation-direction: reverse;
        }

        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ocean-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .ocean-stat {
            text-align: center;
            padding: 8px;
            background: rgba(0, 128, 255, 0.05);
            border-radius: 5px;
        }

        .ocean-stat-value { font-family: 'Orbitron', sans-serif; font-size: 16px; color: var(--primary-blue); }
        .ocean-stat-label { font-size: 9px; color: var(--text-secondary); }

        /* Weather */
        .search-container {
            position: relative;
            margin-bottom: 12px;
        }

        .search-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-glow);
            border-radius: 6px;
            padding: 10px 12px 10px 35px;
            color: var(--text-primary);
            font-family: 'Rajdhani', sans-serif;
            font-size: 13px;
            outline: none;
            transition: all 0.3s;
        }

        .search-input:focus {
            border-color: var(--primary-cyan);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.2);
        }

        .search-input::placeholder { color: var(--text-secondary); }
        .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }

        .weather-card {
            background: linear-gradient(135deg, rgba(0, 128, 255, 0.1), rgba(0, 245, 255, 0.05));
            border-radius: 8px;
            padding: 12px;
        }

        .weather-main {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .weather-icon { font-size: 40px; }
        .weather-temp { font-family: 'Orbitron', sans-serif; font-size: 32px; color: var(--primary-cyan); }
        .weather-unit { font-size: 14px; color: var(--text-secondary); }
        .weather-desc { font-size: 12px; color: var(--text-secondary); }

        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .weather-detail {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            padding: 6px;
            text-align: center;
        }

        .weather-detail-label { font-size: 9px; color: var(--text-secondary); }
        .weather-detail-value { font-size: 12px; color: var(--text-primary); }

        /* Satellite List */
        .sat-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .sat-list::-webkit-scrollbar { width: 4px; }
        .sat-list::-webkit-scrollbar-thumb { background: var(--border-glow); border-radius: 2px; }

        .sat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.02);
            border-radius: 5px;
            margin-bottom: 5px;
            font-size: 11px;
        }

        .sat-name { color: var(--text-primary); }
        .sat-type { font-size: 9px; color: var(--text-secondary); }
        .sat-status { font-size: 18px; }

        /* Radio Blackout */
        .radio-panel {
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .radio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .radio-status {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            padding: 4px 10px;
            border-radius: 5px;
        }

        .radio-status.normal { background: rgba(0, 255, 136, 0.2); color: var(--success-green); }
        .radio-status.minor { background: rgba(255, 204, 0, 0.2); color: #ffcc00; }
        .radio-status.moderate { background: rgba(255, 149, 0, 0.2); color: var(--warning-orange); }
        .radio-status.severe { background: rgba(255, 59, 59, 0.2); color: var(--danger-red); }

        .radio-bands {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .radio-band {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 8px;
            background: rgba(255,255,255,0.02);
            border-radius: 4px;
            font-size: 11px;
        }

        .radio-band-status { font-size: 10px; }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-container { grid-template-columns: 280px 1fr 280px; }
        }

        @media (max-width: 1200px) {
            .main-container { grid-template-columns: 1fr; }
            .header-center { display: none; }
            .bottom-stats { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 768px) {
            .bottom-stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">üõ∞Ô∏è</div>
            <div>
                <div class="logo-text">ORBITAL COMMAND</div>
                <div class="logo-subtitle">Â§™Á©∫Ê∞£Ë±°ÊåáÊèÆ‰∏≠ÂøÉ v2.0</div>
            </div>
        </div>
        <div class="header-center">
            <div class="header-stat">
                <div class="header-stat-value" id="satellites-online">52</div>
                <div class="header-stat-label">Ë°õÊòüÂú®Á∑ö</div>
            </div>
            <div class="header-stat">
                <div class="header-stat-value" id="data-streams">256</div>
                <div class="header-stat-label">Êï∏Êìö‰∏≤ÊµÅ</div>
            </div>
            <div class="header-stat">
                <div class="header-stat-value" id="alert-level">G1</div>
                <div class="header-stat-label">Âú∞Á£ÅË≠¶Â†±</div>
            </div>
            <div class="header-stat">
                <div class="header-stat-value" id="uptime">99.97%</div>
                <div class="header-stat-label">Á≥ªÁµ±ÈÅãË°å</div>
            </div>
        </div>
        <div class="time-display">
            <div id="utc-time">UTC: --:--:--</div>
            <div id="local-time">LOCAL: --:--:--</div>
        </div>
    </header>

    <!-- Alert Bar -->
    <div class="alert-bar" id="alert-bar">
        <span class="alert-icon">‚ö†Ô∏è</span>
        <span class="alert-text" id="alert-text">Á≥ªÁµ±Áõ£Ê∏¨‰∏≠... ÁõÆÂâçÂ§™Á©∫Â§©Ê∞£ÁãÄÊ≥ÅÁ©©ÂÆö | Kp ÊåáÊï∏Ê≠£Â∏∏ | ÁÑ°ÈáçÂ§ßÂ§™ÈôΩÈñÉÁÑ∞‰∫ã‰ª∂ | ISS Ê≠£Â∏∏ÈÅãË°å‰∏≠</span>
    </div>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Left Panel -->
        <aside>
            <!-- Aurora / Kp Index -->
            <div class="panel" style="margin-bottom: 12px;">
                <div class="panel-header">
                    <div class="panel-icon">üåå</div>
                    <div class="panel-title">Ê•µÂÖâÈ†êÂ†±</div>
                    <span class="panel-status">LIVE</span>
                </div>
                <div class="panel-content">
                    <div class="aurora-display">
                        <div class="aurora-stars"></div>
                        <div class="aurora-effect"></div>
                        <div class="aurora-effect-2"></div>
                    </div>
                    <div class="kp-meter">
                        <div class="kp-value" id="kp-value">3</div>
                        <div class="kp-details">
                            <div class="kp-label">Kp Âú∞Á£ÅÊåáÊï∏</div>
                            <div class="kp-status quiet" id="kp-status">Âπ≥Èùú Quiet</div>
                        </div>
                    </div>
                    <div class="kp-bar" id="kp-bar">
                        <div class="kp-bar-segment active-green"></div>
                        <div class="kp-bar-segment active-green"></div>
                        <div class="kp-bar-segment active-green"></div>
                        <div class="kp-bar-segment"></div>
                        <div class="kp-bar-segment"></div>
                        <div class="kp-bar-segment"></div>
                        <div class="kp-bar-segment"></div>
                        <div class="kp-bar-segment"></div>
                        <div class="kp-bar-segment"></div>
                    </div>
                    <div class="aurora-locations">
                        <div class="aurora-location">
                            <span>üáÆüá∏ ÂÜ∞Â≥∂</span>
                            <span class="aurora-location-chance chance-high" id="chance-iceland">85%</span>
                        </div>
                        <div class="aurora-location">
                            <span>üá≥üá¥ Êå™Â®Å</span>
                            <span class="aurora-location-chance chance-high" id="chance-norway">78%</span>
                        </div>
                        <div class="aurora-location">
                            <span>üá´üáÆ Ëä¨Ëò≠</span>
                            <span class="aurora-location-chance chance-medium" id="chance-finland">62%</span>
                        </div>
                        <div class="aurora-location">
                            <span>üáØüáµ ÂåóÊµ∑ÈÅì</span>
                            <span class="aurora-location-chance chance-low" id="chance-japan">12%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Solar Flare -->
            <div class="panel" style="margin-bottom: 12px;">
                <div class="panel-header">
                    <div class="panel-icon">üî•</div>
                    <div class="panel-title">Â§™ÈôΩÈñÉÁÑ∞</div>
                    <span class="panel-status">24H</span>
                </div>
                <div class="panel-content">
                    <div class="flare-grid">
                        <div class="flare-card">
                            <div class="flare-class x" id="flare-x">X0</div>
                            <div class="flare-label">XÁ¥ö</div>
                            <div class="flare-count" id="flare-x-count">0 Ê¨°</div>
                        </div>
                        <div class="flare-card">
                            <div class="flare-class m" id="flare-m">M2</div>
                            <div class="flare-label">MÁ¥ö</div>
                            <div class="flare-count" id="flare-m-count">2 Ê¨°</div>
                        </div>
                        <div class="flare-card">
                            <div class="flare-class c" id="flare-c">C5</div>
                            <div class="flare-label">CÁ¥ö</div>
                            <div class="flare-count" id="flare-c-count">5 Ê¨°</div>
                        </div>
                    </div>
                    <div class="cme-event" id="cme-panel">
                        <div class="cme-header">
                            <span class="cme-title">üåã CME Êó•ÂÜïÊããÂ∞Ñ</span>
                            <span class="cme-time" id="cme-time">2Â∞èÊôÇÂâç</span>
                        </div>
                        <div class="cme-stats">
                            <div class="cme-stat">
                                <div class="cme-stat-value" id="cme-speed">850</div>
                                <div class="cme-stat-label">km/s</div>
                            </div>
                            <div class="cme-stat">
                                <div class="cme-stat-value" id="cme-eta">48h</div>
                                <div class="cme-stat-label">ÊäµÈÅîÊôÇÈñì</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Solar Wind -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-icon">‚òÄÔ∏è</div>
                    <div class="panel-title">Â§™ÈôΩÈ¢®</div>
                </div>
                <div class="panel-content">
                    <div class="solar-stat">
                        <div class="solar-stat-info">
                            <span class="solar-stat-label">È¢®ÈÄü</span>
                            <span class="solar-stat-value" id="solar-speed">425</span>
                            <span class="solar-stat-unit">km/s</span>
                        </div>
                        <span class="solar-stat-trend trend-stable" id="speed-trend">‚Üí</span>
                    </div>
                    <div class="solar-stat">
                        <div class="solar-stat-info">
                            <span class="solar-stat-label">ÂØÜÂ∫¶</span>
                            <span class="solar-stat-value" id="solar-density">4.2</span>
                            <span class="solar-stat-unit">p/cm¬≥</span>
                        </div>
                        <span class="solar-stat-trend trend-down" id="density-trend">‚Üì</span>
                    </div>
                    <div class="solar-stat">
                        <div class="solar-stat-info">
                            <span class="solar-stat-label">Á£ÅÂ†¥ Bz</span>
                            <span class="solar-stat-value" id="solar-bz">-2.1</span>
                            <span class="solar-stat-unit">nT</span>
                        </div>
                        <span class="solar-stat-trend trend-up" id="bz-trend">‚Üë</span>
                    </div>
                    <div class="solar-stat">
                        <div class="solar-stat-info">
                            <span class="solar-stat-label">XÂ∞ÑÁ∑ö</span>
                            <span class="solar-stat-value" id="xray-flux">B3.2</span>
                            <span class="solar-stat-unit">W/m¬≤</span>
                        </div>
                        <span class="solar-stat-trend trend-stable">‚Üí</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Center - Globe -->
        <section class="globe-section">
            <div class="globe-container">
                <canvas id="globe-canvas"></canvas>
                <div class="globe-overlay"></div>
                <div class="globe-controls">
                    <button class="globe-btn active" id="btn-rotate" title="Ëá™ÂãïÊóãËΩâ">üîÑ</button>
                    <button class="globe-btn" id="btn-terminator" title="Êó•Â§úÂàÜÁïå">üåó</button>
                    <button class="globe-btn" id="btn-iss-orbit" title="ISSËªåÈÅì">üõ∏</button>
                    <button class="globe-btn" id="btn-aurora-oval" title="Ê•µÂÖâÂ∏∂">üåå</button>
                    <button class="globe-btn" id="btn-heatmap" title="Ê∫´Â∫¶Âúñ">üå°Ô∏è</button>
                </div>
                <div class="globe-info">
                    <div class="globe-info-row">
                        <div class="globe-info-item">
                            <span class="globe-info-label">LAT:</span>
                            <span class="globe-info-value" id="mouse-lat">--</span>
                        </div>
                        <div class="globe-info-item">
                            <span class="globe-info-label">LON:</span>
                            <span class="globe-info-value" id="mouse-lon">--</span>
                        </div>
                        <div class="globe-info-item">
                            <span class="globe-info-label">ZOOM:</span>
                            <span class="globe-info-value" id="zoom-level">1.0x</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Stats -->
            <div class="bottom-stats">
                <div class="bottom-stat">
                    <div class="bottom-stat-icon">üå°Ô∏è</div>
                    <div class="bottom-stat-value" id="global-temp">15.2¬∞</div>
                    <div class="bottom-stat-label">ÂÖ®ÁêÉÂùáÊ∫´</div>
                </div>
                <div class="bottom-stat">
                    <div class="bottom-stat-icon">üåä</div>
                    <div class="bottom-stat-value" id="sea-level">+3.4</div>
                    <div class="bottom-stat-label">Êµ∑Âπ≥Èù¢ mm/Âπ¥</div>
                </div>
                <div class="bottom-stat">
                    <div class="bottom-stat-icon">‚ùÑÔ∏è</div>
                    <div class="bottom-stat-value" id="arctic-ice">4.2M</div>
                    <div class="bottom-stat-label">ÂåóÊ•µÂÜ∞Â±§</div>
                </div>
                <div class="bottom-stat">
                    <div class="bottom-stat-icon">üåÄ</div>
                    <div class="bottom-stat-value" id="active-storms">3</div>
                    <div class="bottom-stat-label">Ê¥ªË∫çÈ¢®Êö¥</div>
                </div>
                <div class="bottom-stat">
                    <div class="bottom-stat-icon">‚ò¢Ô∏è</div>
                    <div class="bottom-stat-value" id="radiation-level">S1</div>
                    <div class="bottom-stat-label">ËºªÂ∞ÑÈ¢®Êö¥</div>
                </div>
            </div>
        </section>

        <!-- Right Panel -->
        <aside>
            <!-- ISS Tracker -->
            <div class="panel" style="margin-bottom: 12px;">
                <div class="panel-header">
                    <div class="panel-icon">üöÄ</div>
                    <div class="panel-title">ISS ÂúãÈöõÂ§™Á©∫Á´ô</div>
                    <span class="panel-status">LIVE</span>
                </div>
                <div class="panel-content">
                    <div class="iss-card">
                        <div class="iss-header">
                            <span class="iss-icon">üõ∏</span>
                            <div>
                                <div class="iss-title">International Space Station</div>
                                <div class="iss-status">ÂØ¶ÊôÇËøΩËπ§‰∏≠</div>
                            </div>
                        </div>
                        <div class="iss-coords">
                            <div class="iss-coord">
                                <div class="iss-coord-label">Á∑ØÂ∫¶</div>
                                <div class="iss-coord-value" id="iss-lat">--</div>
                            </div>
                            <div class="iss-coord">
                                <div class="iss-coord-label">Á∂ìÂ∫¶</div>
                                <div class="iss-coord-value" id="iss-lon">--</div>
                            </div>
                            <div class="iss-coord">
                                <div class="iss-coord-label">È´òÂ∫¶</div>
                                <div class="iss-coord-value" id="iss-alt">408 km</div>
                            </div>
                            <div class="iss-coord">
                                <div class="iss-coord-label">ÈÄüÂ∫¶</div>
                                <div class="iss-coord-value" id="iss-speed">27,600</div>
                            </div>
                        </div>
                        <div class="iss-orbit-info" id="iss-location">
                            üìç ÁõÆÂâç‰ΩçÁΩÆÔºöË®àÁÆó‰∏≠...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Radiation & Radio -->
            <div class="panel" style="margin-bottom: 12px;">
                <div class="panel-header">
                    <div class="panel-icon">üì°</div>
                    <div class="panel-title">ËºªÂ∞ÑËàáÈÄöË®ä</div>
                </div>
                <div class="panel-content">
                    <div class="tabs">
                        <div class="tab active" onclick="switchTab(this, 'radiation')">‚ò¢Ô∏è ËºªÂ∞Ñ</div>
                        <div class="tab" onclick="switchTab(this, 'radio')">üìª ÁÑ°Á∑öÈõª</div>
                    </div>
                    <div id="tab-radiation">
                        <div class="radiation-meter">
                            <div class="radiation-header">
                                <span style="font-size: 12px; color: var(--text-secondary)">Â§™Á©∫ËºªÂ∞ÑÁ≠âÁ¥ö</span>
                                <span class="radiation-level safe" id="rad-level">S0</span>
                            </div>
                            <div class="radiation-bar">
                                <div class="radiation-bar-fill" id="rad-bar" style="width: 15%;"></div>
                            </div>
                        </div>
                        <div class="solar-stat" style="border-left-color: var(--success-green);">
                            <div class="solar-stat-info">
                                <span class="solar-stat-label">Ë≥™Â≠êÈÄöÈáè >10MeV</span>
                                <span class="solar-stat-value" id="proton-flux">2.3</span>
                                <span class="solar-stat-unit">pfu</span>
                            </div>
                        </div>
                        <div class="solar-stat" style="border-left-color: var(--primary-purple);">
                            <div class="solar-stat-info">
                                <span class="solar-stat-label">ÈõªÂ≠êÈÄöÈáè >2MeV</span>
                                <span class="solar-stat-value" id="electron-flux">1.8e4</span>
                                <span class="solar-stat-unit">pfu</span>
                            </div>
                        </div>
                    </div>
                    <div id="tab-radio" style="display: none;">
                        <div class="radio-panel">
                            <div class="radio-header">
                                <span style="font-size: 11px;">HF ÁÑ°Á∑öÈõª‰∏≠Êñ∑</span>
                                <span class="radio-status normal" id="radio-status">R0</span>
                            </div>
                            <div class="radio-bands">
                                <div class="radio-band">
                                    <span>HF È´òÈ†ª (3-30MHz)</span>
                                    <span class="radio-band-status" style="color: var(--success-green);">Ê≠£Â∏∏</span>
                                </div>
                                <div class="radio-band">
                                    <span>VHF ÁîöÈ´òÈ†ª</span>
                                    <span class="radio-band-status" style="color: var(--success-green);">Ê≠£Â∏∏</span>
                                </div>
                                <div class="radio-band">
                                    <span>GPS Â∞éËà™</span>
                                    <span class="radio-band-status" style="color: var(--success-green);">Ê≠£Â∏∏</span>
                                </div>
                                <div class="radio-band">
                                    <span>Ë°õÊòüÈÄöË®ä</span>
                                    <span class="radio-band-status" style="color: var(--success-green);">Ê≠£Â∏∏</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ocean -->
            <div class="panel" style="margin-bottom: 12px;">
                <div class="panel-header">
                    <div class="panel-icon">üåä</div>
                    <div class="panel-title">Êµ∑Ê≥ÅÁõ£Ê∏¨</div>
                </div>
                <div class="panel-content">
                    <div class="ocean-viz">
                        <div class="wave"></div>
                        <div class="wave"></div>
                    </div>
                    <div class="ocean-stats">
                        <div class="ocean-stat">
                            <div class="ocean-stat-value" id="wave-height">1.8m</div>
                            <div class="ocean-stat-label">Êµ™È´ò</div>
                        </div>
                        <div class="ocean-stat">
                            <div class="ocean-stat-value" id="wave-period">8.2s</div>
                            <div class="ocean-stat-label">ÈÄ±Êúü</div>
                        </div>
                        <div class="ocean-stat">
                            <div class="ocean-stat-value" id="sea-temp">24.5¬∞</div>
                            <div class="ocean-stat-label">Êµ∑Ê∫´</div>
                        </div>
                        <div class="ocean-stat">
                            <div class="ocean-stat-value" id="tide-status">Êº≤ÊΩÆ</div>
                            <div class="ocean-stat-label">ÊΩÆÊ±ê</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weather -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-icon">üå§Ô∏è</div>
                    <div class="panel-title">Âú∞Èù¢Â§©Ê∞£</div>
                </div>
                <div class="panel-content">
                    <div class="search-container">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" id="city-search" placeholder="ÊêúÂ∞ãÂüéÂ∏Ç..." value="È´òÈõÑ">
                    </div>
                    <div class="weather-card">
                        <div class="weather-main">
                            <span class="weather-icon" id="weather-icon">‚òÄÔ∏è</span>
                            <div>
                                <div>
                                    <span class="weather-temp" id="weather-temp">26</span>
                                    <span class="weather-unit">¬∞C</span>
                                </div>
                                <div class="weather-desc" id="weather-desc">Êô¥Â§©</div>
                            </div>
                        </div>
                        <div class="weather-details">
                            <div class="weather-detail">
                                <div class="weather-detail-label">È´îÊÑü</div>
                                <div class="weather-detail-value" id="feels-like">28¬∞C</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">ÊøïÂ∫¶</div>
                                <div class="weather-detail-value" id="humidity">65%</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">È¢®ÈÄü</div>
                                <div class="weather-detail-value" id="wind-speed">3.2 m/s</div>
                            </div>
                            <div class="weather-detail">
                                <div class="weather-detail-label">ËÉΩË¶ãÂ∫¶</div>
                                <div class="weather-detail-value" id="visibility">10 km</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // ==================== ÂÖ®ÂüüËÆäÊï∏ ====================
        let scene, camera, renderer, earth, atmosphere, stars;
        let issMarker, issOrbitLine, terminatorLine, auroraOval;
        let isMouseDown = false;
        let mouseX = 0, mouseY = 0;
        let targetRotationX = 0, targetRotationY = 0;
        let autoRotate = true;
        let showTerminator = false;
        let showISSOrbit = false;
        let showAuroraOval = false;

        // ==================== ÊôÇÈñìÊõ¥Êñ∞ ====================
        function updateTime() {
            const now = new Date();
            const utc = now.toUTCString().split(' ')[4];
            const local = now.toLocaleTimeString('zh-TW', { hour12: false });
            document.getElementById('utc-time').textContent = 'UTC: ' + utc;
            document.getElementById('local-time').textContent = 'LOCAL: ' + local;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ==================== Tab ÂàáÊèõ ====================
        function switchTab(el, tabId) {
            el.parentElement.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('tab-radiation').style.display = tabId === 'radiation' ? 'block' : 'none';
            document.getElementById('tab-radio').style.display = tabId === 'radio' ? 'block' : 'none';
        }

        // ==================== Three.js Âú∞ÁêÉ ====================
        function initGlobe() {
            console.log('üåç ÈñãÂßãÂàùÂßãÂåñÂú∞ÁêÉ...');
            const container = document.getElementById('globe-canvas');
            if (!container) {
                console.error('Êâæ‰∏çÂà∞ globe-canvas ÂÖÉÁ¥†');
                return;
            }
            const parent = container.parentElement;
            const width = parent.clientWidth;
            const height = parent.clientHeight;

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
            camera.position.z = 3;

            renderer = new THREE.WebGLRenderer({ canvas: container, antialias: true, alpha: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            // Earth
            const earthGeometry = new THREE.SphereGeometry(1, 64, 64);
            const earthMaterial = new THREE.MeshPhongMaterial({
                color: 0x1a4d7c,
                emissive: 0x072534,
                specular: 0x333333,
                shininess: 25
            });
            earth = new THREE.Mesh(earthGeometry, earthMaterial);
            scene.add(earth);

            // Wireframe
            const wireframeGeometry = new THREE.SphereGeometry(1.005, 36, 18);
            const wireframeMaterial = new THREE.MeshBasicMaterial({
                color: 0x00f5ff,
                wireframe: true,
                transparent: true,
                opacity: 0.12
            });
            const wireframe = new THREE.Mesh(wireframeGeometry, wireframeMaterial);
            earth.add(wireframe);

            // Atmosphere
            const atmosphereGeometry = new THREE.SphereGeometry(1.12, 64, 64);
            const atmosphereMaterial = new THREE.MeshBasicMaterial({
                color: 0x00f5ff,
                transparent: true,
                opacity: 0.06,
                side: THREE.BackSide
            });
            atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
            scene.add(atmosphere);

            // Aurora rings (polar)
            const auroraGeo = new THREE.RingGeometry(0.15, 0.4, 64);
            const auroraMat = new THREE.MeshBasicMaterial({
                color: 0x00ff88,
                transparent: true,
                opacity: 0.35,
                side: THREE.DoubleSide
            });
            const auroraNorth = new THREE.Mesh(auroraGeo, auroraMat);
            auroraNorth.position.y = 0.92;
            auroraNorth.rotation.x = Math.PI / 2;
            earth.add(auroraNorth);

            const auroraSouth = new THREE.Mesh(auroraGeo, auroraMat.clone());
            auroraSouth.position.y = -0.92;
            auroraSouth.rotation.x = -Math.PI / 2;
            earth.add(auroraSouth);

            // ISS marker
            const issGeo = new THREE.SphereGeometry(0.02, 16, 16);
            const issMat = new THREE.MeshBasicMaterial({ color: 0xff00ff });
            issMarker = new THREE.Mesh(issGeo, issMat);
            scene.add(issMarker);

            // Stars
            const starsGeometry = new THREE.BufferGeometry();
            const starPositions = [];
            for (let i = 0; i < 2500; i++) {
                starPositions.push(
                    (Math.random() - 0.5) * 100,
                    (Math.random() - 0.5) * 100,
                    (Math.random() - 0.5) * 100
                );
            }
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starPositions, 3));
            const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.08 });
            stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);

            // Lights
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xffffff, 1.2);
            sunLight.position.set(5, 3, 5);
            scene.add(sunLight);

            // Events
            container.addEventListener('mousedown', onMouseDown);
            container.addEventListener('mousemove', onMouseMove);
            container.addEventListener('mouseup', onMouseUp);
            container.addEventListener('mouseleave', onMouseUp);
            
            // Ëß∏Êéß‰∫ã‰ª∂ÔºàÊâãÊ©ü/Âπ≥ÊùøÔºâ
            container.addEventListener('touchstart', onTouchStart, { passive: false });
            container.addEventListener('touchmove', onTouchMove, { passive: false });
            container.addEventListener('touchend', onTouchEnd);
            container.addEventListener('wheel', onMouseWheel);
            window.addEventListener('resize', onWindowResize);

            // Control buttons
            document.getElementById('btn-rotate').addEventListener('click', function() {
                autoRotate = !autoRotate;
                this.classList.toggle('active', autoRotate);
            });

            document.getElementById('btn-terminator').addEventListener('click', function() {
                showTerminator = !showTerminator;
                this.classList.toggle('active', showTerminator);
            });

            document.getElementById('btn-iss-orbit').addEventListener('click', function() {
                showISSOrbit = !showISSOrbit;
                this.classList.toggle('active', showISSOrbit);
            });

            document.getElementById('btn-aurora-oval').addEventListener('click', function() {
                showAuroraOval = !showAuroraOval;
                this.classList.toggle('active', showAuroraOval);
            });

            animate();
            console.log('‚úÖ Âú∞ÁêÉÂàùÂßãÂåñÂÆåÊàêÔºåÊªëÈº†ÊãñÊõ≥ÊóãËΩâÂ∑≤ÂïüÁî®');
        }

        function onMouseDown(e) {
            isMouseDown = true;
            mouseX = e.clientX;
            mouseY = e.clientY;
        }

        function onMouseMove(e) {
            if (isMouseDown) {
                const deltaX = e.clientX - mouseX;
                const deltaY = e.clientY - mouseY;
                targetRotationY += deltaX * 0.005;
                targetRotationX += deltaY * 0.005;
                mouseX = e.clientX;
                mouseY = e.clientY;
            }
            const rect = e.target.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            const y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
            document.getElementById('mouse-lat').textContent = (y * 90).toFixed(2) + '¬∞';
            document.getElementById('mouse-lon').textContent = (x * 180).toFixed(2) + '¬∞';
        }

        function onMouseUp() { isMouseDown = false; }

        // Ëß∏Êéß‰∫ã‰ª∂ËôïÁêÜÔºàÊâãÊ©ü/Âπ≥ÊùøÔºâ
        let lastTouchDistance = 0;
        
        function onTouchStart(e) {
            e.preventDefault();
            if (e.touches.length === 1) {
                isMouseDown = true;
                mouseX = e.touches[0].clientX;
                mouseY = e.touches[0].clientY;
            } else if (e.touches.length === 2) {
                // ÈõôÊåáÁ∏ÆÊîæ
                lastTouchDistance = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
            }
        }

        function onTouchMove(e) {
            e.preventDefault();
            if (e.touches.length === 1) {
                // Êõ¥Êñ∞Â∫ßÊ®ôÈ°ØÁ§∫
                const rect = e.target.getBoundingClientRect();
                const x = ((e.touches[0].clientX - rect.left) / rect.width) * 2 - 1;
                const y = -((e.touches[0].clientY - rect.top) / rect.height) * 2 + 1;
                document.getElementById('mouse-lat').textContent = (y * 90).toFixed(2) + '¬∞';
                document.getElementById('mouse-lon').textContent = (x * 180).toFixed(2) + '¬∞';
                
                // ÂñÆÊåáÊóãËΩâ
                if (isMouseDown) {
                    const deltaX = e.touches[0].clientX - mouseX;
                    const deltaY = e.touches[0].clientY - mouseY;
                    targetRotationY += deltaX * 0.008;
                    targetRotationX += deltaY * 0.008;
                    mouseX = e.touches[0].clientX;
                    mouseY = e.touches[0].clientY;
                }
            } else if (e.touches.length === 2) {
                // ÈõôÊåáÁ∏ÆÊîæ
                const currentDistance = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                if (lastTouchDistance > 0) {
                    const delta = (lastTouchDistance - currentDistance) * 0.01;
                    camera.position.z += delta;
                    camera.position.z = Math.max(1.5, Math.min(5, camera.position.z));
                    document.getElementById('zoom-level').textContent = (3 / camera.position.z).toFixed(1) + 'x';
                }
                lastTouchDistance = currentDistance;
            }
        }

        function onTouchEnd() { 
            isMouseDown = false; 
            lastTouchDistance = 0;
        }

        function onMouseWheel(e) {
            e.preventDefault();
            camera.position.z += e.deltaY * 0.002;
            camera.position.z = Math.max(1.5, Math.min(5, camera.position.z));
            document.getElementById('zoom-level').textContent = (3 / camera.position.z).toFixed(1) + 'x';
        }

        function onWindowResize() {
            const container = document.getElementById('globe-canvas').parentElement;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (autoRotate) earth.rotation.y += 0.001;
            earth.rotation.y += (targetRotationY - earth.rotation.y) * 0.1;
            earth.rotation.x += (targetRotationX - earth.rotation.x) * 0.1;
            stars.rotation.y += 0.0001;

            renderer.render(scene, camera);
        }

        // ==================== ISS ËøΩËπ§ ====================
        const COUNTRIES = {
            getCountry: function(lat, lon) {
                if (lat > 20 && lat < 50 && lon > 120 && lon < 150) return 'Êó•Êú¨/Âè∞ÁÅ£ ‰∏äÁ©∫';
                if (lat > 30 && lat < 50 && lon > -130 && lon < -60) return 'ÁæéÂúã ‰∏äÁ©∫';
                if (lat > 35 && lat < 70 && lon > -10 && lon < 40) return 'Ê≠êÊ¥≤ ‰∏äÁ©∫';
                if (lat > -35 && lat < 0 && lon > 110 && lon < 155) return 'Êæ≥Ê¥≤ ‰∏äÁ©∫';
                if (lat > 0 && lat < 55 && lon > 60 && lon < 140) return '‰∫ûÊ¥≤ ‰∏äÁ©∫';
                if (lat > -60 && lat < 15 && lon > -80 && lon < -35) return 'ÂçóÁæéÊ¥≤ ‰∏äÁ©∫';
                if (lat > -35 && lat < 35 && lon > -20 && lon < 50) return 'ÈùûÊ¥≤ ‰∏äÁ©∫';
                if (Math.abs(lat) > 60) return 'Ê•µÂçÄ ‰∏äÁ©∫';
                return 'Êµ∑Ê¥ã ‰∏äÁ©∫';
            }
        };

        async function updateISS() {
            try {
                // ÂÑ™ÂÖà‰ΩøÁî®ÂæåÁ´Ø APIÔºåÂ§±ÊïóÂâáÁõ¥Êé•ÂëºÂè´
                let data;
                try {
                    const res = await fetch('/api/iss');
                    const json = await res.json();
                    if (json.success) {
                        data = json;
                    } else {
                        throw new Error('Backend failed');
                    }
                } catch {
                    const res = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
                    data = await res.json();
                }
                
                const lat = data.lat || data.latitude;
                const lon = data.lon || data.longitude;
                
                document.getElementById('iss-lat').textContent = lat.toFixed(4) + '¬∞';
                document.getElementById('iss-lon').textContent = lon.toFixed(4) + '¬∞';
                document.getElementById('iss-alt').textContent = Math.round(data.altitude) + ' km';
                document.getElementById('iss-speed').textContent = Math.round(data.velocity).toLocaleString();
                document.getElementById('iss-location').textContent = 'üìç ' + COUNTRIES.getCountry(lat, lon);

                // Êõ¥Êñ∞ 3D ‰ΩçÁΩÆ
                if (issMarker) {
                    const phi = (90 - lat) * (Math.PI / 180);
                    const theta = (lon + 180) * (Math.PI / 180);
                    const radius = 1.15;
                    issMarker.position.x = -radius * Math.sin(phi) * Math.cos(theta);
                    issMarker.position.y = radius * Math.cos(phi);
                    issMarker.position.z = radius * Math.sin(phi) * Math.sin(theta);
                }
            } catch (e) {
                console.log('ISS API ÈåØË™§:', e.message);
            }
        }
        setInterval(updateISS, 5000);
        updateISS();

        // ==================== Â§™Á©∫Ê∞£Ë±°Êï∏Êìö ====================
        async function updateSpaceWeather() {
            try {
                // ÂòóË©¶ÂæûÂæåÁ´ØÁç≤ÂèñÂç≥ÊôÇÊï∏Êìö
                const res = await fetch('/api/space-weather');
                const data = await res.json();
                
                if (data.success) {
                    // ‰ΩøÁî®ÁúüÂØ¶Êï∏Êìö
                    const kpValue = data.kp?.kp || 2;
                    document.getElementById('kp-value').textContent = Math.round(kpValue);
                    
                    const kpStatus = document.getElementById('kp-status');
                    kpStatus.className = 'kp-status';
                    const level = data.kp?.level || 'quiet';
                    if (level === 'quiet') { kpStatus.textContent = 'Âπ≥Èùú Quiet'; kpStatus.classList.add('quiet'); }
                    else if (level === 'active') { kpStatus.textContent = 'Ê¥ªË∫ç Active'; kpStatus.classList.add('active'); }
                    else if (level === 'storm') { kpStatus.textContent = 'È¢®Êö¥ Storm'; kpStatus.classList.add('storm'); }
                    else { kpStatus.textContent = 'ÂäáÁÉà Severe'; kpStatus.classList.add('severe'); }

                    // Kp bar
                    const kp = Math.round(kpValue);
                    const kpBar = document.getElementById('kp-bar');
                    const segments = kpBar.querySelectorAll('.kp-bar-segment');
                    segments.forEach((seg, i) => {
                        seg.className = 'kp-bar-segment';
                        if (i < kp) {
                            if (i < 3) seg.classList.add('active-green');
                            else if (i < 5) seg.classList.add('active-yellow');
                            else if (i < 7) seg.classList.add('active-orange');
                            else seg.classList.add('active-red');
                        }
                    });

                    // Ê•µÂÖâÊ©üÁéá
                    if (data.aurora) {
                        document.getElementById('chance-iceland').textContent = data.aurora.iceland + '%';
                        document.getElementById('chance-norway').textContent = data.aurora.norway + '%';
                        document.getElementById('chance-finland').textContent = data.aurora.finland + '%';
                        document.getElementById('chance-japan').textContent = (data.aurora.hokkaido || data.aurora.japan || 10) + '%';
                    }

                    // Âú∞Á£ÅË≠¶Â†±
                    document.getElementById('alert-level').textContent = data.kp?.gLevel || 'G0';

                    // Â§™ÈôΩÈ¢®
                    document.getElementById('solar-speed').textContent = Math.round(data.solarWind?.speed || 400);
                    document.getElementById('solar-density').textContent = (data.solarWind?.density || 4).toFixed(1);
                    document.getElementById('solar-bz').textContent = (data.magneticField?.bz || 0).toFixed(1);

                    // ÈñÉÁÑ∞
                    const flareClass = data.xray?.flareClass || 'B';
                    document.getElementById('flare-x').textContent = flareClass === 'X' ? 'X1.0' : 'X0';
                    document.getElementById('flare-m').textContent = flareClass === 'M' ? 'M' + (Math.random() * 5 + 1).toFixed(1) : 'M1.0';
                    document.getElementById('flare-c').textContent = 'C' + (Math.random() * 5 + 1).toFixed(1);

                    // CME
                    if (data.cme && data.cme.length > 0) {
                        const latestCME = data.cme[data.cme.length - 1];
                        document.getElementById('cme-speed').textContent = Math.round(latestCME.speed || 700);
                    }

                    // ËºªÂ∞Ñ
                    const sLevel = data.proton?.sLevel || 'S0';
                    document.getElementById('rad-level').textContent = sLevel;
                    document.getElementById('radiation-level').textContent = sLevel;
                    const sNum = parseInt(sLevel.replace('S', '')) || 0;
                    document.getElementById('rad-bar').style.width = (10 + sNum * 18) + '%';
                    document.getElementById('proton-flux').textContent = (data.proton?.flux || 1).toFixed(1);

                    // Ë≠¶Â†±ÊñáÂ≠ó
                    document.getElementById('alert-text').textContent = 
                        `Âç≥ÊôÇÊï∏ÊìöÊõ¥Êñ∞‰∏≠... Kp=${Math.round(kpValue)} | Â§™ÈôΩÈ¢® ${Math.round(data.solarWind?.speed || 400)} km/s | ${data.kp?.gLevel || 'G0'} Âú∞Á£ÅË≠¶Â†± | ISS Ê≠£Â∏∏ÈÅãË°å‰∏≠`;
                    
                    return;
                }
            } catch (e) {
                console.log('‰ΩøÁî®Ê®°Êì¨Êï∏Êìö:', e.message);
            }

            // ÂæåÁ´ØÂ§±ÊïóÊôÇ‰ΩøÁî®Ê®°Êì¨Êï∏Êìö
            const kp = Math.floor(Math.random() * 5) + 1;
            document.getElementById('kp-value').textContent = kp;
            
            const kpStatus = document.getElementById('kp-status');
            kpStatus.className = 'kp-status';
            if (kp <= 2) { kpStatus.textContent = 'Âπ≥Èùú Quiet'; kpStatus.classList.add('quiet'); }
            else if (kp <= 4) { kpStatus.textContent = 'Ê¥ªË∫ç Active'; kpStatus.classList.add('active'); }
            else if (kp <= 6) { kpStatus.textContent = 'È¢®Êö¥ Storm'; kpStatus.classList.add('storm'); }
            else { kpStatus.textContent = 'ÂäáÁÉà Severe'; kpStatus.classList.add('severe'); }

            const kpBar = document.getElementById('kp-bar');
            const segments = kpBar.querySelectorAll('.kp-bar-segment');
            segments.forEach((seg, i) => {
                seg.className = 'kp-bar-segment';
                if (i < kp) {
                    if (i < 3) seg.classList.add('active-green');
                    else if (i < 5) seg.classList.add('active-yellow');
                    else if (i < 7) seg.classList.add('active-orange');
                    else seg.classList.add('active-red');
                }
            });

            const baseChance = kp * 15;
            document.getElementById('chance-iceland').textContent = Math.min(95, baseChance + 40) + '%';
            document.getElementById('chance-norway').textContent = Math.min(90, baseChance + 30) + '%';
            document.getElementById('chance-finland').textContent = Math.min(85, baseChance + 20) + '%';
            document.getElementById('chance-japan').textContent = Math.max(5, baseChance - 30) + '%';

            const gLevels = ['G0', 'G1', 'G1', 'G2', 'G2', 'G3', 'G3', 'G4', 'G5'];
            document.getElementById('alert-level').textContent = gLevels[kp] || 'G0';

            document.getElementById('solar-speed').textContent = (380 + Math.random() * 120).toFixed(0);
            document.getElementById('solar-density').textContent = (2 + Math.random() * 6).toFixed(1);
            document.getElementById('solar-bz').textContent = (-5 + Math.random() * 10).toFixed(1);

            document.getElementById('flare-x').textContent = Math.random() > 0.8 ? 'X' + (Math.random() * 3).toFixed(1) : 'X0';
            document.getElementById('flare-m').textContent = 'M' + (Math.random() * 9 + 1).toFixed(1);
            document.getElementById('flare-c').textContent = 'C' + (Math.random() * 9 + 1).toFixed(1);

            document.getElementById('cme-speed').textContent = (600 + Math.random() * 600).toFixed(0);
            document.getElementById('cme-eta').textContent = Math.floor(24 + Math.random() * 48) + 'h';

            const sLevels = ['S0', 'S1', 'S1', 'S2'];
            const sLevel = sLevels[Math.floor(Math.random() * sLevels.length)];
            document.getElementById('rad-level').textContent = sLevel;
            document.getElementById('radiation-level').textContent = sLevel;
            document.getElementById('rad-bar').style.width = (15 + Math.random() * 30) + '%';
            document.getElementById('proton-flux').textContent = (1 + Math.random() * 5).toFixed(1);
            document.getElementById('electron-flux').textContent = (1 + Math.random() * 3).toFixed(1) + 'e4';

            const trends = ['‚Üë', '‚Üì', '‚Üí'];
            const trendClasses = ['trend-up', 'trend-down', 'trend-stable'];
            ['speed-trend', 'density-trend', 'bz-trend'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    const idx = Math.floor(Math.random() * 3);
                    el.textContent = trends[idx];
                    el.className = 'solar-stat-trend ' + trendClasses[idx];
                }
            });

            const alerts = [
                'Á≥ªÁµ±Áõ£Ê∏¨‰∏≠... ÁõÆÂâçÂ§™Á©∫Â§©Ê∞£ÁãÄÊ≥ÅÁ©©ÂÆö',
                'Ê≥®ÊÑèÔºöÂ§™ÈôΩÈ¢®ÈÄüÂ∫¶Áï•Êúâ‰∏äÂçá',
                'ÂÅµÊ∏¨Âà∞ M Á¥öÂ§™ÈôΩÈñÉÁÑ∞Ê¥ªÂãï',
                'Ê•µÂÖâÊ¥ªÂãïÂ¢ûÂº∑ÔºåÈ´òÁ∑ØÂ∫¶Âú∞ÂçÄÂèØË¶ã'
            ];
            document.getElementById('alert-text').textContent = alerts[Math.floor(Math.random() * alerts.length)] + 
                ' | Kp=' + kp + ' | ISS Ê≠£Â∏∏ÈÅãË°å‰∏≠ | Ë°õÊòüÈÄöË®äÊ≠£Â∏∏';
        }
        setInterval(updateSpaceWeather, 30000);
        updateSpaceWeather();

        // ==================== Êµ∑Ê≥ÅÊï∏Êìö ====================
        function updateOcean() {
            document.getElementById('wave-height').textContent = (1 + Math.random() * 2).toFixed(1) + 'm';
            document.getElementById('wave-period').textContent = (6 + Math.random() * 4).toFixed(1) + 's';
            document.getElementById('sea-temp').textContent = (22 + Math.random() * 6).toFixed(1) + '¬∞';
            
            const tides = ['Êº≤ÊΩÆ', 'ÊªøÊΩÆ', 'ÈÄÄÊΩÆ', '‰πæÊΩÆ'];
            document.getElementById('tide-status').textContent = tides[Math.floor(Math.random() * tides.length)];
        }
        setInterval(updateOcean, 60000);
        updateOcean();

        // ==================== Â§©Ê∞£ ====================
        const WEATHER_ICONS = {
            'Clear': '‚òÄÔ∏è', 'Sunny': '‚òÄÔ∏è', 'Clouds': '‚òÅÔ∏è', 'Cloudy': '‚òÅÔ∏è',
            'Partly cloudy': '‚õÖ', 'Rain': 'üåßÔ∏è', 'Drizzle': 'üå¶Ô∏è',
            'Thunderstorm': '‚õàÔ∏è', 'Snow': '‚ùÑÔ∏è', 'Fog': 'üå´Ô∏è', 'Mist': 'üå´Ô∏è'
        };

        const CITIES = {
            'È´òÈõÑ': { lat: 22.6273, lon: 120.3014 },
            'Âè∞Âåó': { lat: 25.0330, lon: 121.5654 },
            'Êù±‰∫¨': { lat: 35.6762, lon: 139.6503 },
            'È¶ñÁàæ': { lat: 37.5665, lon: 126.9780 },
            'Á¥êÁ¥Ñ': { lat: 40.7128, lon: -74.0060 },
            'ÂÄ´Êï¶': { lat: 51.5074, lon: -0.1278 },
            'Èõ∑ÂÖãÈõÖÁ∂≠ÂÖã': { lat: 64.1466, lon: -21.9426 },
            'ÁâπÁæÖÂßÜÁëü': { lat: 69.6492, lon: 18.9553 }
        };

        async function fetchWeather(city) {
            const coords = CITIES[city] || CITIES['È´òÈõÑ'];
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,visibility`);
                const data = await res.json();
                
                const weatherCodes = {
                    0: 'Clear', 1: 'Partly cloudy', 2: 'Cloudy', 3: 'Cloudy',
                    45: 'Fog', 48: 'Fog', 51: 'Drizzle', 53: 'Drizzle', 55: 'Drizzle',
                    61: 'Rain', 63: 'Rain', 65: 'Rain', 71: 'Snow', 73: 'Snow', 75: 'Snow',
                    80: 'Rain', 81: 'Rain', 82: 'Rain', 95: 'Thunderstorm'
                };

                const condition = weatherCodes[data.current.weather_code] || 'Clear';
                const icon = WEATHER_ICONS[condition] || 'üå§Ô∏è';

                document.getElementById('weather-icon').textContent = icon;
                document.getElementById('weather-temp').textContent = Math.round(data.current.temperature_2m);
                document.getElementById('weather-desc').textContent = condition;
                document.getElementById('feels-like').textContent = Math.round(data.current.apparent_temperature) + '¬∞C';
                document.getElementById('humidity').textContent = data.current.relative_humidity_2m + '%';
                document.getElementById('wind-speed').textContent = (data.current.wind_speed_10m / 3.6).toFixed(1) + ' m/s';
                document.getElementById('visibility').textContent = (data.current.visibility / 1000).toFixed(0) + ' km';
            } catch (e) {
                console.log('Â§©Ê∞£ API ÈåØË™§');
            }
        }

        document.getElementById('city-search').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') fetchWeather(e.target.value);
        });

        // ==================== ÂàùÂßãÂåñ ====================
        document.addEventListener('DOMContentLoaded', () => {
            initGlobe();
            fetchWeather('È´òÈõÑ');
            
            setInterval(() => {
                document.getElementById('satellites-online').textContent = 48 + Math.floor(Math.random() * 8);
                document.getElementById('data-streams').textContent = 240 + Math.floor(Math.random() * 30);
            }, 10000);
        });
    </script>
</body>
</html>
